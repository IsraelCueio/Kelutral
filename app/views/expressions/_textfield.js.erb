
    function GetValue(value,blur){
        $('#teste').val();

        let pattern = /[^A-zÀ-ú"'\s]/gi; //Pattern to be removed from the words array
        let sep_pattern = /[^A-zÀ-ú"']/gi; //Pattern to separate words in the array(includes white_space)
        value = value.toLowerCase() //Make input lowercase

        var words_JSON = "<%= @words_JSON.to_json %>"
        words_JSON = words_JSON.replace(/&quot;/ig,'"');
        words_JSON = JSON.parse(words_JSON)
        let existent_words = []

        var phrases_JSON = "<%= @phrases_JSON.to_json %>"
        phrases_JSON = phrases_JSON.replace(/&quot;/ig,'"');
        phrases_JSON = JSON.parse(phrases_JSON)
        let existent_phrases = []
        let existent_word_ids = []

        let last_char = value.slice(-1)
        //Separates the words by white_spaces or special signs(!%&#$ ...)
        if ((last_char.match(pattern) != null) || (last_char == " ") || (blur == true)){
            
            let full_phrase = value.trim()
            //Treats the input for the entry into the words array
            let trtd_value = full_phrase.split(sep_pattern)//Separate the array by special chars and white_spaces
            trtd_value = trtd_value.filter(Boolean)//Remove blanck spaces
            var terms = trtd_value
            console.log("words: " + terms);
            console.log("frase: " + full_phrase);
            for(var i in words_JSON)
                existent_words.push((words_JSON[i].name).toLowerCase())
            let new_words = terms.filter(x => !existent_words.includes(x))
            console.log("Novas palavras: " + new_words)

            for(var i = 0; i < terms.length; i++)
                for(var j in words_JSON)
                    if (terms[i] == (words_JSON[j].name).toLowerCase())
                        existent_word_ids.push(words_JSON[j].id)

            for(var i in phrases_JSON)
                if((full_phrase.toLowerCase()) == (phrases_JSON[i].text.toLowerCase()))
                    var existent_phrase_id = phrases_JSON[i].id 
            WordJSON(existent_word_ids,existent_phrase_id)
        }
        
        
    }
    function WordJSON(existent_word_ids,existent_phrase_id){
        var expression = []

        console.log("existent_word_ids: " + existent_word_ids.length)
        for (var i = 0; i < existent_word_ids.length;i++){
            expression[i] = {}
            expression[i].word_id = existent_word_ids[i]
            expression[i].phrase_id = existent_phrase_id
            
        }
        expressions = {}
        expressions.expressions = expression
        expression = JSON.stringify(expression)
        console.log(expression)

        $('#json_sender').val(expression)
    }